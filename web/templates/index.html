{{define "content"}}
<div x-data="dashboard()" x-init="init()">
    <!-- Hero Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="stat-card">
            <div class="text-sm text-gray-400 uppercase tracking-wide">Total Kills</div>
            <div class="text-3xl font-bold text-mohaa-sand" x-text="formatNumber(stats.totalKills)">--</div>
            <div class="text-xs text-green-400">+<span x-text="formatNumber(stats.killsToday)">0</span> today</div>
        </div>
        <div class="stat-card">
            <div class="text-sm text-gray-400 uppercase tracking-wide">Active Players</div>
            <div class="text-3xl font-bold text-mohaa-sand" x-text="formatNumber(stats.activePlayers)">--</div>
            <div class="text-xs text-gray-500">Last 7 days</div>
        </div>
        <div class="stat-card">
            <div class="text-sm text-gray-400 uppercase tracking-wide">Matches Played</div>
            <div class="text-3xl font-bold text-mohaa-sand" x-text="formatNumber(stats.totalMatches)">--</div>
            <div class="text-xs text-gray-500">All time</div>
        </div>
        <div class="stat-card">
            <div class="text-sm text-gray-400 uppercase tracking-wide">Live Now</div>
            <div class="text-3xl font-bold text-green-400" x-text="liveMatches.length">0</div>
            <div class="text-xs text-gray-500">Active matches</div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- Left Column: Leaderboard (4 cols) -->
        <div class="lg:col-span-4 space-y-6">
            <div class="bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden backdrop-blur-sm">
                <div class="px-4 py-3 border-b border-gray-700 flex justify-between items-center bg-gray-900/50">
                    <h2 class="text-lg font-semibold text-mohaa-sand">Top Players</h2>
                    <div class="flex space-x-2">
                        <button @click="leaderboardPeriod = 'all'"
                            :class="leaderboardPeriod === 'all' ? 'bg-mohaa-olive text-white shadow-lg' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'"
                            class="px-2 py-1 text-xs rounded transition font-medium">All</button>
                        <button @click="leaderboardPeriod = 'weekly'"
                            :class="leaderboardPeriod === 'weekly' ? 'bg-mohaa-olive text-white shadow-lg' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'"
                            class="px-2 py-1 text-xs rounded transition font-medium">Week</button>
                    </div>
                </div>
                <div id="leaderboard-container" hx-get="/partials/leaderboard"
                    hx-trigger="load, leaderboardChanged from:body" hx-swap="innerHTML"
                    class="divide-y divide-gray-700/50">
                    <!-- Skeleton loading -->
                    <template x-for="i in 5">
                        <div class="px-4 py-3 flex items-center space-x-3 animate-pulse">
                            <div class="bg-gray-700 w-8 h-8 rounded-full"></div>
                            <div class="flex-1 space-y-2">
                                <div class="bg-gray-700 h-4 w-24 rounded"></div>
                            </div>
                            <div class="bg-gray-700 h-4 w-8 rounded"></div>
                        </div>
                    </template>
                </div>
                <a href="/leaderboards"
                    class="block px-4 py-3 text-center text-sm text-mohaa-sand hover:bg-gray-700 transition font-medium">
                    View Full Leaderboard â†’
                </a>
            </div>

            <!-- Player DNA Radar -->
            <div class="bg-gray-800/50 rounded-lg border border-gray-700 p-4 backdrop-blur-sm">
                <h2 class="text-lg font-semibold mb-4 text-mohaa-sand flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                        </path>
                    </svg>
                    Server DNA
                </h2>
                <div class="h-64 relative">
                    <canvas id="dnaChart"></canvas>
                </div>
                <p class="text-xs text-center text-gray-400 mt-2">Average player combat profile</p>
            </div>
        </div>

        <!-- Center/Right Column: Creative Stats & Charts (8 cols) -->
        <div class="lg:col-span-8 space-y-6">

            <!-- Creative Stats Carousel (The "Fun" Widget) -->
            <div
                class="bg-gradient-to-r from-gray-800 to-gray-900 rounded-xl border border-gray-700 p-6 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <svg class="w-32 h-32 text-mohaa-olive" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                        </path>
                    </svg>
                </div>

                <h2
                    class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-mohaa-sand to-yellow-500 mb-4">
                    Hall of Fame & Shame
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" x-data="{
                    activeCard: 0,
                    cards: [
                        { title: 'The Pacifist', icon: 'ðŸ•Šï¸', name: 'Loading...', value: '0 Games', desc: 'Most games without killing' },
                        { title: 'Executioner', icon: 'ðŸ’€', name: 'Loading...', value: '0 HS', desc: 'Most headshots' },
                        { title: 'Loot Goblin', icon: 'ðŸ’°', name: 'Loading...', value: '0 Items', desc: 'Most items pickup' },
                        { title: 'Marathon', icon: 'ðŸƒ', name: 'Loading...', value: '0km', desc: 'Distance traveled' },
                        { title: 'Chatterbox', icon: 'ðŸ’¬', name: 'Loading...', value: '0 Msgs', desc: 'Most chat messages' },
                        { title: 'Gravedigger', icon: 'âš°ï¸', name: 'Loading...', value: '0 Bains', desc: 'Most bash kills' }
                    ]
                }" x-init="
                    fetch('/api/v1/stats/leaderboard/cards').then(r => r.json()).then(data => {
                        if(data.pacifist) { cards[0].name = data.pacifist[0]?.name; cards[0].value = data.pacifist[0]?.value + ' Games'; }
                        if(data.executioner) { cards[1].name = data.executioner[0]?.name; cards[1].value = data.executioner[0]?.value + ' HS'; }
                        if(data.loot_goblin) { cards[2].name = data.loot_goblin[0]?.name; cards[2].value = data.loot_goblin[0]?.value; }
                        if(data.marathon) { cards[3].name = data.marathon[0]?.name; cards[3].value = data.marathon[0]?.value; }
                        if(data.chatterbox) { cards[4].name = data.chatterbox[0]?.name; cards[4].value = data.chatterbox[0]?.value + ' Msgs'; }
                        if(data.gravedigger) { cards[5].name = data.gravedigger[0]?.name; cards[5].value = data.gravedigger[0]?.value + ' Kills'; }
                    })
                ">
                    <template x-for="card in cards" :key="card.title">
                        <div
                            class="bg-gray-800/80 rounded-lg p-4 border border-gray-700 hover:border-mohaa-olive/50 hover:bg-gray-750 transition duration-300 relative overflow-hidden">
                            <div class="absolute -right-4 -bottom-4 text-6xl opacity-5 grayscale custom-grayscale-transition"
                                x-text="card.icon"></div>
                            <div class="text-xs text-mohaa-olive font-bold uppercase tracking-widest mb-1"
                                x-text="card.title"></div>
                            <div class="text-lg font-bold text-white truncate" x-text="card.name || 'None'"></div>
                            <div class="text-2xl font-black text-mohaa-sand/90 font-mono" x-text="card.value"></div>
                            <div class="text-[10px] text-gray-500 mt-1" x-text="card.desc"></div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Activity Chart -->
                <div class="bg-gray-800/50 rounded-lg border border-gray-700 p-4 backdrop-blur-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-200">Activity Pulse</h2>
                        <select x-model="activityRange" @change="updateActivityChart()"
                            class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs text-gray-300 focus:ring-1 focus:ring-mohaa-olive outline-none">
                            <option value="24h">24h</option>
                            <option value="7d">7 Days</option>
                        </select>
                    </div>
                    <div class="h-48">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>

                <!-- Weapon Stats Chart -->
                <div class="bg-gray-800/50 rounded-lg border border-gray-700 p-4 backdrop-blur-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-200">Arsenal</h2>
                        <div class="flex space-x-2 bg-gray-700 rounded p-1">
                            <button @click="weaponChartType = 'bar'"
                                :class="weaponChartType === 'bar' ? 'bg-gray-600 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'"
                                class="px-2 py-0.5 text-xs rounded transition">Bar</button>
                            <button @click="weaponChartType = 'pie'"
                                :class="weaponChartType === 'pie' ? 'bg-gray-600 text-white shadow-sm' : 'text-gray-400 hover:text-gray-200'"
                                class="px-2 py-0.5 text-xs rounded transition">Pie</button>
                        </div>
                    </div>
                    <div class="h-48">
                        <canvas id="weaponChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- K/D & HS Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-800/50 rounded-lg border border-gray-700 p-4">
                    <h3 class="text-md font-semibold mb-4 text-gray-300">Kill/Death Distribution</h3>
                    <div class="h-40">
                        <canvas id="kdChart"></canvas>
                    </div>
                </div>
                <div class="bg-gray-800/50 rounded-lg border border-gray-700 p-4">
                    <h3 class="text-md font-semibold mb-4 text-gray-300">Precision (HS%)</h3>
                    <div class="h-40">
                        <canvas id="hsChart"></canvas>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Live Matches Section -->
    <div class="mt-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Live Matches</h2>
            <span class="text-sm text-gray-400" x-text="'Auto-refreshing every 10s'"></span>
        </div>
        <div id="live-matches" hx-get="/partials/live-matches" hx-trigger="load, every 10s" hx-swap="innerHTML"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Live matches will be loaded here -->
        </div>
    </div>

    <!-- Recent Matches -->
    <div class="mt-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Recent Matches</h2>
            <a href="/matches" class="text-sm text-mohaa-sand hover:underline">View All â†’</a>
        </div>
        <div id="recent-matches" hx-get="/partials/recent-matches" hx-trigger="load" hx-swap="innerHTML"
            class="space-y-2">
            <!-- Recent matches will be loaded here -->
        </div>
    </div>
</div>

<script>
    function dashboard() {
        return {
            stats: {
                totalKills: 0,
                killsToday: 0,
                activePlayers: 0,
                totalMatches: 0
            },
            liveMatches: [],
            leaderboardPeriod: 'all',
            activityRange: '7d',
            weaponChartType: 'bar',
            charts: {},

            async init() {
                await this.fetchStats();
                this.initCharts();

                // Watch for changes
                this.$watch('weaponChartType', () => this.updateWeaponChart());
            },

            async fetchStats() {
                try {
                    // In production, fetch from API
                    // For now, simulate data
                    this.stats = {
                        totalKills: 1547832,
                        killsToday: 4521,
                        activePlayers: 892,
                        totalMatches: 45782
                    };
                } catch (e) {
                    console.error('Failed to fetch stats:', e);
                }
            },

            formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num?.toString() || '0';
            },

            initCharts() {
                this.initActivityChart();
                this.initWeaponChart();
                this.initKDChart();
                this.initHSChart();
                this.initDNAChart();
            },

            initDNAChart() {
                const ctx = document.getElementById('dnaChart');
                if (!ctx) return;

                // Radar Chart for Player DNA
                this.charts.dna = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Aggression', 'Precision', 'Survival', 'Teamwork', 'Objective', 'Mobility'],
                        datasets: [{
                            label: 'Server Average',
                            data: [65, 59, 90, 81, 56, 55],
                            fill: true,
                            backgroundColor: 'rgba(74, 93, 35, 0.2)',
                            borderColor: '#4a5d23',
                            pointBackgroundColor: '#4a5d23',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#4a5d23'
                        }, {
                            label: 'Top Player',
                            data: [28, 48, 40, 19, 96, 27],
                            fill: true,
                            backgroundColor: 'rgba(194, 178, 128, 0.2)',
                            borderColor: '#c2b280',
                            pointBackgroundColor: '#c2b280',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#c2b280'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        elements: {
                            line: { borderWidth: 2 }
                        },
                        scales: {
                            r: {
                                angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                pointLabels: { color: '#9ca3af', font: { size: 10 } },
                                ticks: { backdropColor: 'transparent', display: false }
                            }
                        },
                        plugins: {
                            legend: { position: 'top', labels: { color: '#e5e7eb', font: { size: 10 } } }
                        }
                    }
                });
            },

            initActivityChart() {
                const ctx = document.getElementById('activityChart');
                if (!ctx) return;

                const labels = [];
                const kills = [];
                const players = [];

                // Generate sample data for last 7 days
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                    kills.push(Math.floor(Math.random() * 5000) + 2000);
                    players.push(Math.floor(Math.random() * 200) + 100);
                }

                this.charts.activity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Kills',
                                data: kills,
                                borderColor: '#4a5d23',
                                backgroundColor: (context) => {
                                    const ctx = context.chart.ctx;
                                    const gradient = ctx.createLinearGradient(0, 0, 0, 200);
                                    gradient.addColorStop(0, 'rgba(74, 93, 35, 0.5)');
                                    gradient.addColorStop(1, 'rgba(74, 93, 35, 0.0)');
                                    return gradient;
                                },
                                fill: true,
                                tension: 0.4,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Active Players',
                                data: players,
                                borderColor: '#c2b280',
                                backgroundColor: 'transparent',
                                borderDash: [5, 5],
                                tension: 0.4,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                grid: { color: 'rgba(75, 85, 99, 0.2)' },
                                ticks: { color: '#9ca3af' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: { drawOnChartArea: false },
                                ticks: { color: '#9ca3af' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#9ca3af' }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            },

            initWeaponChart() {
                const ctx = document.getElementById('weaponChart');
                if (!ctx) return;

                const weaponData = {
                    labels: ['M1 Garand', 'Thompson', 'MP40', 'Kar98k', 'Springfield', 'BAR', 'StG44', 'Grenade'],
                    data: [24500, 21200, 19800, 15400, 12100, 9800, 8500, 7200]
                };

                const colors = [
                    '#4a5d23', '#5a7d33', '#6a9d43', '#7abd53',
                    '#c2b280', '#d2c290', '#e2d2a0', '#8b4513'
                ];

                this.charts.weapon = new Chart(ctx, {
                    type: this.weaponChartType === 'pie' ? 'doughnut' : 'bar',
                    data: {
                        labels: weaponData.labels,
                        datasets: [{
                            label: 'Kills',
                            data: weaponData.data,
                            backgroundColor: colors,
                            borderColor: colors.map(c => c),
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: this.weaponChartType === 'pie',
                                position: 'right',
                                labels: { color: '#e5e7eb' }
                            }
                        },
                        scales: this.weaponChartType === 'bar' ? {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(75, 85, 99, 0.2)' },
                                ticks: { color: '#9ca3af' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#9ca3af' }
                            }
                        } : {}
                    }
                });
            },

            updateWeaponChart() {
                if (this.charts.weapon) {
                    this.charts.weapon.destroy();
                    this.initWeaponChart();
                }
            },

            initKDChart() {
                const ctx = document.getElementById('kdChart');
                if (!ctx) return;

                // K/D ratio distribution histogram
                const kdRanges = ['<0.5', '0.5-1.0', '1.0-1.5', '1.5-2.0', '2.0-2.5', '2.5-3.0', '>3.0'];
                const playerCounts = [120, 340, 280, 95, 35, 15, 7];

                this.charts.kd = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: kdRanges,
                        datasets: [{
                            label: 'Players',
                            data: playerCounts,
                            backgroundColor: '#4a5d23',
                            borderRadius: 4,
                            barPercentage: 0.6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(75, 85, 99, 0.2)' },
                                ticks: { color: '#9ca3af' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#9ca3af', font: { size: 10 } }
                            }
                        }
                    }
                });
            },

            initHSChart() {
                const ctx = document.getElementById('hsChart');
                if (!ctx) return;

                // Headshot percentage gauge/radial
                this.charts.hs = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Headshots', 'Body/Other'],
                        datasets: [{
                            data: [23.5, 76.5],
                            backgroundColor: ['#c2b280', 'rgba(75, 85, 99, 0.1)'],
                            borderWidth: 0,
                            cutout: '75%'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: true }
                        }
                    },
                    plugins: [{
                        id: 'centerText',
                        beforeDraw: function (chart) {
                            const ctx = chart.ctx;
                            const centerX = chart.width / 2;
                            const centerY = chart.height / 2;

                            ctx.save();
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillStyle = '#c2b280';
                            ctx.font = 'bold 20px sans-serif';
                            ctx.fillText('23.5%', centerX, centerY - 5);
                            ctx.font = '10px sans-serif';
                            ctx.fillStyle = '#9ca3af';
                            ctx.fillText('HS Rate', centerX, centerY + 12);
                            ctx.restore();
                        }
                    }]
                });
            },

            updateActivityChart() {
                // Would fetch new data based on range
                console.log('Updating activity chart for range:', this.activityRange);
            }
        }
    }
</script>
{{end}}